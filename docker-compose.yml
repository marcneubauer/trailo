services:
  api:
    build:
      context: .
      dockerfile: Dockerfile.api
    ports:
      - "3001:3001"
    volumes:
      - db-data:/app/packages/api/data
    environment:
      - DATABASE_URL=/app/packages/api/data/kanbang.db
      - SESSION_SECRET=${SESSION_SECRET:-change-me-to-a-random-string-at-least-32-chars}
      - API_PORT=3001
      - API_HOST=0.0.0.0
      - RP_ID=${RP_ID:-localhost}
      - RP_NAME=${RP_NAME:-KanBang}
      - RP_ORIGIN=${RP_ORIGIN:-http://localhost:3000}
      - CORS_ORIGIN=${CORS_ORIGIN:-http://localhost:3000}
      - NODE_ENV=production
    restart: unless-stopped

  web:
    build:
      context: .
      dockerfile: Dockerfile.web
    ports:
      - "3000:3000"
    environment:
      - API_URL=http://api:3001
      - ORIGIN=${ORIGIN:-http://localhost:3000}
      - PORT=3000
      - NODE_ENV=production
    depends_on:
      - api
    restart: unless-stopped

volumes:
  db-data:
